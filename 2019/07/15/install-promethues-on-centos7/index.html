<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/c46aecdc.js","daovoice")
  daovoice('init', {
      app_id: "c46aecdc"
    });
  daovoice('update');
  </script>




















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-ewu_32px.ico?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-ewu_16px.ico?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #4B0305; /*进度条颜色*/
        height: 1px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

  <meta name="description" content="Prometheus 是什么？Prometheus是一套开源的监控&amp;amp;报警&amp;amp;时间序列数据库的组合，起始是由SoundCloud公司开发的。随着发展，越来越多公司和组织接受采用Prometheus，社区也十分活跃，他们便将它独立成开源项目，并且有公司来运作。google SRE的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。现在最常见的Kubernetes容">
<meta name="keywords" content="promethues,devops">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS 7中安装和配置Promethues">
<meta property="og:url" content="http://easonwy.github.com/2019/07/15/install-promethues-on-centos7/index.html">
<meta property="og:site_name" content="光脚码农笔记">
<meta property="og:description" content="Prometheus 是什么？Prometheus是一套开源的监控&amp;amp;报警&amp;amp;时间序列数据库的组合，起始是由SoundCloud公司开发的。随着发展，越来越多公司和组织接受采用Prometheus，社区也十分活跃，他们便将它独立成开源项目，并且有公司来运作。google SRE的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。现在最常见的Kubernetes容">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50p65yvu5j311j0mjjtq.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50qzy9gi1j30yo0hjgly.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50t57jtdzj310c0rlmxx.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50t95td65j30mz07fjre.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti23d2zj30q00gqaab.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti2b51sj30q00f1aah.jpg">
<meta property="og:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti2gp23j313b0mfwex.jpg">
<meta property="og:updated_time" content="2019-07-16T10:39:16.567Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS 7中安装和配置Promethues">
<meta name="twitter:description" content="Prometheus 是什么？Prometheus是一套开源的监控&amp;amp;报警&amp;amp;时间序列数据库的组合，起始是由SoundCloud公司开发的。随着发展，越来越多公司和组织接受采用Prometheus，社区也十分活跃，他们便将它独立成开源项目，并且有公司来运作。google SRE的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。现在最常见的Kubernetes容">
<meta name="twitter:image" content="http://tva1.sinaimg.cn/large/0060lm7Tly1g50p65yvu5j311j0mjjtq.jpg">






  <link rel="canonical" href="http://easonwy.github.com/2019/07/15/install-promethues-on-centos7/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>CentOS 7中安装和配置Promethues | 光脚码农笔记</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a33df49a1446db342f037174a7607fcf";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
   
    <a href="https://github.com/easonwy" class="github-corner" aria-label="View source on Github"><svg width="92" height="92" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
   
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">光脚码农笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-about menu-item-active">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://easonwy.github.com/2019/07/15/install-promethues-on-centos7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="翼神">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="光脚码农笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CentOS 7中安装和配置Promethues</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-07-15T18:06:39+08:00">2019-07-15</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/07/15/install-promethues-on-centos7/" class="leancloud_visitors" data-flag-title="CentOS 7中安装和配置Promethues">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Prometheus-是什么？"><a href="#Prometheus-是什么？" class="headerlink" title="Prometheus 是什么？"></a>Prometheus 是什么？</h3><p><a href="https://prometheus.io/" target="_blank" rel="noopener">Prometheus</a>是一套开源的监控&amp;报警&amp;时间序列数据库的组合，起始是由<a href="https://soundcloud.com/" target="_blank" rel="noopener">SoundCloud</a>公司开发的。随着发展，越来越多公司和组织接受采用Prometheus，社区也十分活跃，他们便将它独立成开源项目，并且有公司来运作。google SRE的书内也曾提到跟他们BorgMon监控系统相似的实现是Prometheus。现在最常见的Kubernetes容器管理系统中，通常会搭配Prometheus进行监控。类似的产品还有influxdb, 如果用于监控用途是通常会配合grafana进行数据展示和报警。</p>
<h4 id="Prometheus-的优点"><a href="#Prometheus-的优点" class="headerlink" title="Prometheus 的优点"></a>Prometheus 的优点</h4><ul>
<li>非常少的外部依赖，安装使用超简单</li>
<li>已经有非常多的系统集成， 例如：Docker、StatsD、HAProxy、Nginx、JMX等</li>
<li>服务自动化发现</li>
<li>直接集成到代码</li>
<li>设计思想是按照分布式、微服务架构来实现的</li>
</ul>
<h4 id="Prometheus-的特性"><a href="#Prometheus-的特性" class="headerlink" title="Prometheus 的特性"></a>Prometheus 的特性</h4><ul>
<li>自定义多维度的数据模型</li>
<li>非常高效的存储 平均一个采样数据占 ~3.5 bytes左右，320万的时间序列，每30秒采样，保持60天，消耗磁盘大概228G。</li>
<li>强大的查询语句</li>
<li>轻松实现强大的数据可视化</li>
<li>简单的操作，每一个Server都是一个独立的实现，仅仅依赖本地存储。</li>
<li>精确的告警功能。</li>
<li>丰富的客户端library</li>
</ul>
<p>更详细的说明和帮助，可以参考prometheus官网： <a href="https://prometheus.io/" target="_blank" rel="noopener">https://prometheus.io/</a></p>
<h4 id="Prometheus的架构"><a href="#Prometheus的架构" class="headerlink" title="Prometheus的架构"></a>Prometheus的架构</h4><p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50p65yvu5j311j0mjjtq.jpg" alt></p>
<h4 id="Prometheus使用的场景"><a href="#Prometheus使用的场景" class="headerlink" title="Prometheus使用的场景"></a>Prometheus使用的场景</h4><p>如官网描述的一样，prometheus主要是在当我们需要单纯记录以时间进行分片的数据时使用，无论是系统级别的监控，或是我们的高度动态的服务架构。针对微服务场景，prometheus也能很好的支持多为数据的收集和查询。</p>
<p>当然，prometheus也有局限性，如果我们的监控或系统，需要百分百的准确性就不太适合。</p>
<blockquote>
<p>需要了解更多关于prometheus的知识，强烈建议好好阅读官网的<a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">文档</a>。</p>
</blockquote>
<h3 id="Prometheus的安装"><a href="#Prometheus的安装" class="headerlink" title="Prometheus的安装"></a>Prometheus的安装</h3><p>本文的重点是如何在CentOS 7中安装和配置Prometheus，我们要按生产级的要求来部署Prometheus。以下就开始我们的部署工作， 按步骤进行操作。</p>
<h4 id="基础准备"><a href="#基础准备" class="headerlink" title="基础准备"></a>基础准备</h4><p>以root或具有sudo权限的用户登录CentOS系统，执行以下命令升级系统（非必要）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br></pre></td></tr></table></figure>
<h5 id="禁用SELinux"><a href="#禁用SELinux" class="headerlink" title="禁用SELinux"></a>禁用SELinux</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/selinux</span><br></pre></td></tr></table></figure>
<p>将<code>SELINUX=enforcing</code>改为<code>ELINUX=disabled</code>, 然后重启系统<code>reboot</code>。</p>
<h5 id="同步时区（-设置系统时区为上海）"><a href="#同步时区（-设置系统时区为上海）" class="headerlink" title="同步时区（ 设置系统时区为上海）"></a>同步时区（ 设置系统时区为上海）</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<h4 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /data/software/</span><br><span class="line">wget https://github.com/prometheus/prometheus/releases/download/v2.11.1/prometheus-2.11.1.linux-amd64.tar.gz</span><br><span class="line">tar -zxvf prometheus-2.11.1.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="创建执行用户"><a href="#创建执行用户" class="headerlink" title="创建执行用户"></a>创建执行用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd --no-create-home --shell /bin/false prometheus</span><br></pre></td></tr></table></figure>
<h4 id="创建执行目录"><a href="#创建执行目录" class="headerlink" title="创建执行目录"></a>创建执行目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/prometheus</span><br><span class="line">mkdir /var/lib/prometheus</span><br></pre></td></tr></table></figure>
<h4 id="修改目录权限（更改所有者）"><a href="#修改目录权限（更改所有者）" class="headerlink" title="修改目录权限（更改所有者）"></a>修改目录权限（更改所有者）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown prometheus:prometheus /etc/prometheus</span><br><span class="line">chown prometheus:prometheus /var/lib/prometheus</span><br></pre></td></tr></table></figure>
<h4 id="复制文件到执行目录"><a href="#复制文件到执行目录" class="headerlink" title="复制文件到执行目录"></a>复制文件到执行目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /data/software/prometheus-2.11.1.linux-amd64</span><br><span class="line">cp prometheus /usr/local/bin/</span><br><span class="line">cp promtool /usr/local/bin/</span><br><span class="line"></span><br><span class="line"># 设置权限（更改所有者）</span><br><span class="line">chown prometheus:prometheus /usr/local/bin/prometheus</span><br><span class="line">chown prometheus:prometheus /usr/local/bin/promtool</span><br><span class="line"></span><br><span class="line">cp -r consoles /etc/prometheus</span><br><span class="line">cp -r console_libraries /etc/prometheus</span><br><span class="line">chown -R prometheus:prometheus /etc/prometheus/consoles</span><br><span class="line">chown -R prometheus:prometheus /etc/prometheus/console_libraries</span><br></pre></td></tr></table></figure>
<h4 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/prometheus/</span><br><span class="line">cp prometheus.xml /etc/prometheus/ or vim /etc/systemd/system/prometheus.service</span><br><span class="line">chown prometheus:prometheus /etc/prometheus/prometheus.yml</span><br></pre></td></tr></table></figure>
<p>当然，如果没有模板文件的话，也可以新创建一个，具体配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># my global config</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">  # scrape_timeout is set to the global default (10s).</span><br><span class="line"></span><br><span class="line"># Alertmanager configuration</span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      # - alertmanager:9093</span><br><span class="line"></span><br><span class="line"># Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.</span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first_rules.yml&quot;</span><br><span class="line">  # - &quot;second_rules.yml&quot;</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line"></span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: [&apos;localhost:9090&apos;]</span><br></pre></td></tr></table></figure>
<h4 id="创建服务"><a href="#创建服务" class="headerlink" title="创建服务"></a>创建服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/systemd/system/prometheus.service</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Prometheus</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=prometheus</span><br><span class="line">Group=prometheus</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/prometheus \</span><br><span class="line">--config.file /etc/prometheus/prometheus.yml \</span><br><span class="line">--storage.tsdb.path /var/lib/prometheus/ \</span><br><span class="line">--web.console.templates=/etc/prometheus/consoles \</span><br><span class="line">--web.console.libraries=/etc/prometheus/console_libraries</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> reload服务配置</span><br><span class="line">systemctl daemon-reload </span><br><span class="line"><span class="meta">#</span> 启动服务</span><br><span class="line">systemctl start prometheus </span><br><span class="line"><span class="meta">#</span> 查看服务状态</span><br><span class="line">systemctl status prometheus</span><br></pre></td></tr></table></figure>
<p>如果一切正常应该可以看到如下输出， 说明服务以及正常启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ ~]# systemctl status prometheus</span><br><span class="line">● prometheus.service - Prometheus</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/prometheus.service; enabled; vendor prese                                                               t: disabled)</span><br><span class="line">   Active: active (running) since Mon 2019-07-15 17:43:53 CST; 1h 34min ago</span><br><span class="line"> Main PID: 22807 (prometheus)</span><br><span class="line">   CGroup: /system.slice/prometheus.service</span><br><span class="line">           └─22807 /usr/local/bin/prometheus --config.file /etc/prometheus/pr...</span><br><span class="line"></span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.660Z...)"</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.660Z...)"</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.661Z...)"</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.663Z...."</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.674Z...IC</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.674Z...d"</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.674Z...ml</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.695Z...90</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.698Z...ml</span><br><span class="line">Jul 15 17:43:53 . prometheus[22807]: level=info ts=2019-07-15T09:43:53.698Z...."</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>
<h4 id="设置服务开机启动"><a href="#设置服务开机启动" class="headerlink" title="设置服务开机启动"></a>设置服务开机启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable prometheus</span><br></pre></td></tr></table></figure>
<p>也可以试一下重启系统，看服务会不会自动开启。</p>
<h4 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h4><p>因为我们的配置文件中配置的端口为<code>9090</code>, 所以如果你的系统有设置防火墙，这需要将这个端口开放出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9090/tcp --permanent</span><br><span class="line"></span><br><span class="line"># 重启防火墙服务</span><br><span class="line">systemctl reload firewalld</span><br></pre></td></tr></table></figure>
<h4 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h4><p>因为我是在虚拟机里安装的，直接在宿主机浏览器中输入: <code>http://192.168.56.2:9090</code>，如果出现以下页面这表示服务正常开启。</p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50qzy9gi1j30yo0hjgly.jpg" alt></p>
<h3 id="安装exporter"><a href="#安装exporter" class="headerlink" title="安装exporter"></a>安装exporter</h3><p>exporter是prometheus用来收集数据的客户端工具，在prometheus的官网上<a href="https://prometheus.io/download/" target="_blank" rel="noopener">https://prometheus.io/download/</a> 可以下载到很多服务的exporter采集器。以下是我们经常用到的一些采集器：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node Exporter</td>
<td>针对服务器进行监控的探测器（探针）</td>
<td><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener">https://github.com/prometheus/node_exporter</a></td>
</tr>
<tr>
<td>Alert Manager</td>
<td>报警相关</td>
<td><a href="https://github.com/prometheus/alertmanager" target="_blank" rel="noopener">https://github.com/prometheus/alertmanager</a></td>
</tr>
<tr>
<td>Mysql Exporter</td>
<td>MySQL服务监控相关的探测器</td>
<td><a href="https://github.com/prometheus/mysqld_exporter" target="_blank" rel="noopener">https://github.com/prometheus/mysqld_exporter</a></td>
</tr>
<tr>
<td>Blackbox Exporter</td>
<td>黑盒监控解决方案，其允许用户通过：HTTP、HTTPS、DNS、TCP以及ICMP的方式对网络进行探测</td>
<td><a href="https://github.com/prometheus/blackbox_exporter" target="_blank" rel="noopener">https://github.com/prometheus/blackbox_exporter</a></td>
</tr>
<tr>
<td>jmx_exporter</td>
<td>JMX服务的探测器</td>
<td><a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter</a></td>
</tr>
</tbody>
</table>
<blockquote>
<p>具体的可以到我们使用时再行在<a href="https://prometheus.io/download/或github中寻找需要的插件进行安装配置，这里我们就简单介绍几个常用的插件的安装和使用。" target="_blank" rel="noopener">https://prometheus.io/download/或github中寻找需要的插件进行安装配置，这里我们就简单介绍几个常用的插件的安装和使用。</a></p>
</blockquote>
<h4 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node_exporter"></a>node_exporter</h4><p>node_exporter是一个服务器端agent，负责采集服务器基础监控项。下面我们就来一步一步安装node_exporter收集所在服务器的性能。</p>
<h5 id="下载安装包-1"><a href="#下载安装包-1" class="headerlink" title="下载安装包"></a>下载安装包</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz</span><br><span class="line">tar -zvxf node_exporter-0.18.1.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<h5 id="添加执行用户"><a href="#添加执行用户" class="headerlink" title="添加执行用户"></a>添加执行用户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -rs /bin/false nodeusr</span><br></pre></td></tr></table></figure>
<h5 id="复制执行文件"><a href="#复制执行文件" class="headerlink" title="复制执行文件"></a>复制执行文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp node_exporter-0.18.1.linux-amd64/node_exporter  /usr/local/bin/</span><br></pre></td></tr></table></figure>
<h5 id="创建系统服务"><a href="#创建系统服务" class="headerlink" title="创建系统服务"></a>创建系统服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/node_exporter.service</span><br></pre></td></tr></table></figure>
<p>内容如下: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Node Exporter</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=nodeusr</span><br><span class="line">Group=nodeusr</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/node_exporter</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h5 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start node_exporter</span><br></pre></td></tr></table></figure>
<p>查看服务状态，如果正常的话会显示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@ software]# systemctl status node_exporter</span><br><span class="line">● node_exporter.service - Node Exporter</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/node_exporter.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2019-07-15 20:10:48 CST; 20min ago</span><br><span class="line"> Main PID: 30530 (node_exporter)</span><br><span class="line">   CGroup: /system.slice/node_exporter.service</span><br><span class="line">           └─30530 /usr/local/bin/node_exporter</span><br><span class="line"></span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - sockstat&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - stat&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - textfile&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - time&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - timex&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - uname&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - vmstat&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - xfs&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot; - zfs&quot; source=&quot;node_exporter.go:104&quot;</span><br><span class="line">Jul 15 20:10:48 . node_exporter[30530]: time=&quot;2019-07-15T20:10:48+08:00&quot; level=info msg=&quot;Listening on :9100&quot; source=&quot;node_exporter.go:170&quot;</span><br></pre></td></tr></table></figure>
<h5 id="设置服务开机自启动"><a href="#设置服务开机自启动" class="headerlink" title="设置服务开机自启动"></a>设置服务开机自启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable node_exporter</span><br></pre></td></tr></table></figure>
<h5 id="开启防火墙"><a href="#开启防火墙" class="headerlink" title="开启防火墙"></a>开启防火墙</h5><p>如果防火墙服务有开启的话，就需要开通端口: 9100</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9100/tcp --permanent</span><br><span class="line">systemctl restart firewalld</span><br></pre></td></tr></table></figure>
<h5 id="查看服务"><a href="#查看服务" class="headerlink" title="查看服务"></a>查看服务</h5><p>在宿主机浏览器输入<code>http://192.168.56.2:9100/metrics</code></p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50t57jtdzj310c0rlmxx.jpg" alt></p>
<h5 id="将node-exporter加入prometheus的配置"><a href="#将node-exporter加入prometheus的配置" class="headerlink" title="将node_exporter加入prometheus的配置"></a>将node_exporter加入prometheus的配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/prometheus/prometheus.yml</span><br></pre></td></tr></table></figure>
<p>在prometheus.xml中的scrape配置项中加入以下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- job_name: &apos;node_exporter_centos&apos;</span><br><span class="line">   scrape_interval: 5s</span><br><span class="line">   static_configs:</span><br><span class="line">     - targets: [&apos;192.168.56.2:9100&apos;]</span><br></pre></td></tr></table></figure>
<p>最终的配置文件如下：</p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50t95td65j30mz07fjre.jpg" alt></p>
<p>然后重新启动prometheus服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart prometheus</span><br></pre></td></tr></table></figure>
<h5 id="prometheus中查看node-exporter的数据"><a href="#prometheus中查看node-exporter的数据" class="headerlink" title="prometheus中查看node_exporter的数据"></a>prometheus中查看node_exporter的数据</h5><p>在宿主机的浏览器中输入prometheus的地址,  <code>http://192.168.56.2:9090/graph</code></p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti23d2zj30q00gqaab.jpg" alt></p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti2b51sj30q00f1aah.jpg" alt></p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g50ti2gp23j313b0mfwex.jpg" alt></p>
<h4 id="MySQL-Exporter"><a href="#MySQL-Exporter" class="headerlink" title="MySQL Exporter"></a>MySQL Exporter</h4><h5 id="下载安装包-2"><a href="#下载安装包-2" class="headerlink" title="下载安装包"></a>下载安装包</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://prometheus.io/docs/introduction/overview/" target="_blank" rel="noopener">https://prometheus.io/docs/introduction/overview/</a></li>
<li><a href="https://www.fosslinux.com/10398/how-to-install-and-configure-prometheus-on-centos-7.htm" target="_blank" rel="noopener">https://www.fosslinux.com/10398/how-to-install-and-configure-prometheus-on-centos-7.htm</a></li>
</ul>

      
    </div>

    

    
    
    

    
    
      <div>
        <div>
    <div style="margin: 20px 0; text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
</div>
      </div>
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/promethues-devops/" rel="tag"><i class="fa fa-tag"></i> promethues,devops</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/15/virtualbox-failed-to-instantiate-clsid/" rel="next" title="VirtualBox出现Failed to instantiate CLSID_VirtualBox异常">
                <i class="fa fa-chevron-left"></i> VirtualBox出现Failed to instantiate CLSID_VirtualBox异常
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/07/16/install-grafana-on-centos7/" rel="prev" title="install-grafana-on-centos7">
                install-grafana-on-centos7 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNTU5Mi8xMjEyOA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="翼神">
            
              <p class="site-author-name" itemprop="name">翼神</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/easonwy" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:easonwu85@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Prometheus-是什么？"><span class="nav-number">1.</span> <span class="nav-text">Prometheus 是什么？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Prometheus-的优点"><span class="nav-number">1.1.</span> <span class="nav-text">Prometheus 的优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prometheus-的特性"><span class="nav-number">1.2.</span> <span class="nav-text">Prometheus 的特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prometheus的架构"><span class="nav-number">1.3.</span> <span class="nav-text">Prometheus的架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Prometheus使用的场景"><span class="nav-number">1.4.</span> <span class="nav-text">Prometheus使用的场景</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Prometheus的安装"><span class="nav-number">2.</span> <span class="nav-text">Prometheus的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基础准备"><span class="nav-number">2.1.</span> <span class="nav-text">基础准备</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#禁用SELinux"><span class="nav-number">2.1.1.</span> <span class="nav-text">禁用SELinux</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#同步时区（-设置系统时区为上海）"><span class="nav-number">2.1.2.</span> <span class="nav-text">同步时区（ 设置系统时区为上海）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下载安装包"><span class="nav-number">2.2.</span> <span class="nav-text">下载安装包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建执行用户"><span class="nav-number">2.3.</span> <span class="nav-text">创建执行用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建执行目录"><span class="nav-number">2.4.</span> <span class="nav-text">创建执行目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改目录权限（更改所有者）"><span class="nav-number">2.5.</span> <span class="nav-text">修改目录权限（更改所有者）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#复制文件到执行目录"><span class="nav-number">2.6.</span> <span class="nav-text">复制文件到执行目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加配置文件"><span class="nav-number">2.7.</span> <span class="nav-text">添加配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建服务"><span class="nav-number">2.8.</span> <span class="nav-text">创建服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#启动服务"><span class="nav-number">2.9.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#设置服务开机启动"><span class="nav-number">2.10.</span> <span class="nav-text">设置服务开机启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#防火墙设置"><span class="nav-number">2.11.</span> <span class="nav-text">防火墙设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问页面"><span class="nav-number">2.12.</span> <span class="nav-text">访问页面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装exporter"><span class="nav-number">3.</span> <span class="nav-text">安装exporter</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#node-exporter"><span class="nav-number">3.1.</span> <span class="nav-text">node_exporter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#下载安装包-1"><span class="nav-number">3.1.1.</span> <span class="nav-text">下载安装包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#添加执行用户"><span class="nav-number">3.1.2.</span> <span class="nav-text">添加执行用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#复制执行文件"><span class="nav-number">3.1.3.</span> <span class="nav-text">复制执行文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建系统服务"><span class="nav-number">3.1.4.</span> <span class="nav-text">创建系统服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动服务-1"><span class="nav-number">3.1.5.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#设置服务开机自启动"><span class="nav-number">3.1.6.</span> <span class="nav-text">设置服务开机自启动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#开启防火墙"><span class="nav-number">3.1.7.</span> <span class="nav-text">开启防火墙</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#查看服务"><span class="nav-number">3.1.8.</span> <span class="nav-text">查看服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#将node-exporter加入prometheus的配置"><span class="nav-number">3.1.9.</span> <span class="nav-text">将node_exporter加入prometheus的配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#prometheus中查看node-exporter的数据"><span class="nav-number">3.1.10.</span> <span class="nav-text">prometheus中查看node_exporter的数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL-Exporter"><span class="nav-number">3.2.</span> <span class="nav-text">MySQL Exporter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#下载安装包-2"><span class="nav-number">3.2.1.</span> <span class="nav-text">下载安装包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文档"><span class="nav-number">4.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">翼神</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("RJcyloaaqVU2EDYLipsQXxsT-gzGzoHsz", "jvkJyc2w3aYDSOuGj6LKFAeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  


  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
