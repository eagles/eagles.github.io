<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/c46aecdc.js","daovoice")
  daovoice('init', {
      app_id: "c46aecdc"
    });
  daovoice('update');
  </script>




















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-dog_32px.ico?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-dog_16px.ico?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #4B0305; /*进度条颜色*/
        height: 1px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

  <meta name="description" content="azkaban是一个非常好的任务调度程序，基于java编写，主要用于大数据方面的任务调度，本文主要介绍如何在centos系统中安装azkaban 2.5.0。">
<meta name="keywords" content="centos,java,azkaban">
<meta property="og:type" content="article">
<meta property="og:title" content="Azkaban 2.5.0安装(CentOS)">
<meta property="og:url" content="http://easonwy.github.com/2019/04/14/install-azkaban-2-5-0-in-centos/index.html">
<meta property="og:site_name" content="Eason&#39;s Notes">
<meta property="og:description" content="azkaban是一个非常好的任务调度程序，基于java编写，主要用于大数据方面的任务调度，本文主要介绍如何在centos系统中安装azkaban 2.5.0。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/68ce759fly1g1qg49bnonj20fc0azglx.jpg">
<meta property="og:updated_time" content="2019-04-14T14:05:54.693Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Azkaban 2.5.0安装(CentOS)">
<meta name="twitter:description" content="azkaban是一个非常好的任务调度程序，基于java编写，主要用于大数据方面的任务调度，本文主要介绍如何在centos系统中安装azkaban 2.5.0。">
<meta name="twitter:image" content="https://ws3.sinaimg.cn/large/68ce759fly1g1qg49bnonj20fc0azglx.jpg">






  <link rel="canonical" href="http://easonwy.github.com/2019/04/14/install-azkaban-2-5-0-in-centos/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Azkaban 2.5.0安装(CentOS) | Eason's Notes</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a33df49a1446db342f037174a7607fcf";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
   
    <a href="https://github.com/easonwy" class="github-corner" aria-label="View source on Github"><svg width="92" height="92" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
   
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Eason's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-about menu-item-active">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://easonwy.github.com/2019/04/14/install-azkaban-2-5-0-in-centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eason Wu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eason's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Azkaban 2.5.0安装(CentOS)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-14T22:02:19+08:00">2019-04-14</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/big-data/" itemprop="url" rel="index"><span itemprop="name">big-data</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2019/04/14/install-azkaban-2-5-0-in-centos/" class="leancloud_visitors" data-flag-title="Azkaban 2.5.0安装(CentOS)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          
              <div class="post-description">azkaban是一个非常好的任务调度程序，基于java编写，主要用于大数据方面的任务调度，本文主要介绍如何在centos系统中安装azkaban 2.5.0。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h5 id="必备软件"><a href="#必备软件" class="headerlink" title="必备软件"></a>必备软件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install git -y</span><br></pre></td></tr></table></figure>
<h5 id="单机安装步骤"><a href="#单机安装步骤" class="headerlink" title="单机安装步骤"></a>单机安装步骤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/azkaban/azkaban.git</span><br><span class="line">cd azkaban; ./gradlew build installDist</span><br><span class="line">cd azkaban-solo-server/build/install/azkaban-solo-server; bin/start-solo.sh</span><br><span class="line"><span class="meta">#</span> open http://localhost:8081/</span><br><span class="line">bin/shutdown-solo.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 当然，这个也需要你的网络环境比较好，如果是公司网络限制比较多的话，可能出现无法编译的情况，比如无法访问gradle的plugin站点等。</span><br></pre></td></tr></table></figure>
<h5 id="多执行器模式安装"><a href="#多执行器模式安装" class="headerlink" title="多执行器模式安装"></a>多执行器模式安装</h5><h5 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h5><p>方法1：下载azkaban代码，编译。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/azkaban/azkaban.git</span><br><span class="line">or</span><br><span class="line">git clone https://gitee.com/mirrors/azkaban.git</span><br><span class="line">cd azkaban; ./gradlew build installDist</span><br><span class="line">cd azkaban-db; ../gradlew build installDist</span><br><span class="line"><span class="meta">#</span> 当然，这个也需要你的网络环境比较好，如果是公司网络限制比较多的话，可能出现无法编译的情况，比如无法访问gradle的plugin站点等。</span><br></pre></td></tr></table></figure>
<p>方法2：直接下载别人编译好的版本进行安装</p>
<p><a href="https://pan.baidu.com/s/1tq8FLME2zHR539sTAZUw2A" target="_blank" rel="noopener">https://pan.baidu.com/s/1tq8FLME2zHR539sTAZUw2A</a> | zkl9</p>
<p>这个共享包里是基于2.5.0的版本，下载下来三个文件：</p>
<p><code>azkaban-executor-2.5.0.zip</code> <code>azkaban-web-2.5.0.zip</code> <code>azkaban-sql-script-2.5.0.tar.gz</code></p>
<h5 id="登陆mysql-设置编码为utf8-为Azkaban创建数据库-并授权-导入脚本"><a href="#登陆mysql-设置编码为utf8-为Azkaban创建数据库-并授权-导入脚本" class="headerlink" title="登陆mysql, 设置编码为utf8, 为Azkaban创建数据库, 并授权, 导入脚本"></a>登陆mysql, 设置编码为utf8, 为Azkaban创建数据库, 并授权, 导入脚本</h5><p>azkaban官方建议使用mysql作为后端的数据存储db，使用如下命令创建azkaban的数据库:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456;</span><br><span class="line"><span class="meta">mysql&gt;</span> CREATE DATABASE azkaban;</span><br><span class="line">CREATE USER 'azkaban'@'%' IDENTIFIED BY  '123456';</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO 'azkaban'@'192.168.56.3' IDENTIFIED BY '123456';</span><br><span class="line">flush privileges;</span><br><span class="line">source /usr/local/azkaban/azkaban-sql/create-all-sql-2.5.0.sql;</span><br></pre></td></tr></table></figure>
<h5 id="创建SSL配置"><a href="#创建SSL配置" class="headerlink" title="创建SSL配置"></a>创建SSL配置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore keystore -alias jetty -genkey -keyalg RSA # (记住密码)</span><br><span class="line">cp keystore /usr/local/azkaban/azkaban-web #将当前目录生成 keystore证书文件拷贝到web服务器根目录中</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tzselect #使用交互式命令设置时区(Asia/Shanghai, 选北京就是上海)</span><br><span class="line">输入密钥库口令:  </span><br><span class="line">密钥库口令太短 - 至少必须为 6 个字符</span><br><span class="line">输入密钥库口令:  </span><br><span class="line">再次输入新口令: </span><br><span class="line">您的名字与姓氏是什么?</span><br><span class="line">[Unknown]:  cao</span><br><span class="line">您的组织单位名称是什么?</span><br><span class="line">[Unknown]:  parllay</span><br><span class="line">您的组织名称是什么?</span><br><span class="line">[Unknown]:  fenghuotai</span><br><span class="line">您所在的城市或区域名称是什么?</span><br><span class="line">[Unknown]:  beijing</span><br><span class="line">您所在的省/市/自治区名称是什么?</span><br><span class="line">[Unknown]:  beijing</span><br><span class="line">该单位的双字母国家/地区代码是什么?</span><br><span class="line">[Unknown]:  CN</span><br><span class="line">CN=cao, OU=parllay, O=fenghuotai, L=beijing, ST=beijing, C=CN是否正确?[否]:  Y</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime #拷贝该时区文件，覆盖系统本地时区配置</span><br></pre></td></tr></table></figure>
<h5 id="zkaban-web服务器配置及用户配置-进入web服务器安装目录conf"><a href="#zkaban-web服务器配置及用户配置-进入web服务器安装目录conf" class="headerlink" title="zkaban web服务器配置及用户配置, 进入web服务器安装目录conf"></a>zkaban web服务器配置及用户配置, 进入web服务器安装目录conf</h5><p><strong>web服务器配置如下:</strong></p>
<p><code>vim azkaban.properties</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>Azkaban Personalization Settings</span><br><span class="line">azkaban.name=Test</span><br><span class="line">azkaban.label=My Local Azkaban</span><br><span class="line">azkaban.color=#FF3601</span><br><span class="line">azkaban.default.servlet.path=/index</span><br><span class="line">web.resource.dir=web/</span><br><span class="line">default.timezone.id=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Azkaban UserManager class</span><br><span class="line">user.manager.class=azkaban.user.XmlUserManager</span><br><span class="line">user.manager.xml.file=conf/azkaban-users.xml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Loader for projects</span><br><span class="line">executor.global.properties=conf/global.properties</span><br><span class="line">azkaban.project.dir=projects</span><br><span class="line"></span><br><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=192.168.33.205</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=root</span><br><span class="line">mysql.password=root</span><br><span class="line">mysql.numconnections=100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Velocity dev mode</span><br><span class="line">velocity.dev.mode=false</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Azkaban Jetty server properties.</span><br><span class="line">jetty.maxThreads=25</span><br><span class="line">jetty.ssl.port=8443</span><br><span class="line">jetty.port=8081</span><br><span class="line">jetty.keystore=keystore</span><br><span class="line">jetty.password=111111</span><br><span class="line">jetty.keypassword=111111</span><br><span class="line">jetty.truststore=keystore</span><br><span class="line">jetty.trustpassword=111111</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Azkaban Executor settings</span><br><span class="line">executor.port=12321</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> mail settings</span><br><span class="line"><span class="meta">#</span> 发送邮箱</span><br><span class="line">mail.sender=</span><br><span class="line"><span class="meta">#</span>发送邮箱smtp地址</span><br><span class="line">mail.host=</span><br><span class="line"><span class="meta">#</span> 任务失败时发送邮件的地址</span><br><span class="line">job.failure.email=</span><br><span class="line"><span class="meta">#</span> 任务成功时发送邮件的地址</span><br><span class="line">job.success.email=</span><br><span class="line"></span><br><span class="line">lockdown.create.projects=false</span><br><span class="line">cache.directory=cache</span><br></pre></td></tr></table></figure>
<p><strong>用户配置如下:</strong></p>
<p><code>vim azkaban-users.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">azkaban-users</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"azkaban"</span> <span class="attr">password</span>=<span class="string">"azkaban"</span> <span class="attr">roles</span>=<span class="string">"admin"</span> <span class="attr">groups</span>=<span class="string">"azkaban"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"metrics"</span> <span class="attr">password</span>=<span class="string">"metrics"</span> <span class="attr">roles</span>=<span class="string">"metrics"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置登录 https://192.168.56.3:8443的账号和密码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">roles</span>=<span class="string">"admin,metrics"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"admin"</span> <span class="attr">permissions</span>=<span class="string">"ADMIN"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">role</span> <span class="attr">name</span>=<span class="string">"metrics"</span> <span class="attr">permissions</span>=<span class="string">"METRICS"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">azkaban-users</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="azkaban-executor服务器配置-进入执行服务器安装目录conf"><a href="#azkaban-executor服务器配置-进入执行服务器安装目录conf" class="headerlink" title="azkaban executor服务器配置, 进入执行服务器安装目录conf"></a>azkaban executor服务器配置, 进入执行服务器安装目录conf</h5><p><code>vim azkaban.properties</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>Azkaban</span><br><span class="line">default.timezone.id=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Azkaban JobTypes Plugins</span><br><span class="line">azkaban.jobtype.plugin.dir=plugins/jobtypes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Loader for projects</span><br><span class="line">executor.global.properties=conf/global.properties</span><br><span class="line">azkaban.project.dir=projects</span><br><span class="line"></span><br><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=192.168.33.205</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=root</span><br><span class="line">mysql.password=root</span><br><span class="line">mysql.numconnections=100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Azkaban Executor settings</span><br><span class="line">executor.maxThreads=50</span><br><span class="line">executor.port=12321</span><br><span class="line">executor.flow.threads=30</span><br></pre></td></tr></table></figure>
<h5 id="启动各个服务器"><a href="#启动各个服务器" class="headerlink" title="启动各个服务器"></a>启动各个服务器</h5><p><strong>azkaban web服务器的启动与关闭, 注意: 只能在web服务器根目录运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-web-start.sh</span><br><span class="line">bin/azkaban-web-shutdown.sh</span><br><span class="line"><span class="meta">#</span> 如果是正式环境可以采用nohup的方式手动启动</span><br></pre></td></tr></table></figure>
<p><strong>azkaban executor服务器的启动与关闭, 注意: 只能在执行服务器根目录运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-executor-start.sh</span><br><span class="line">bin/azkaban-executor-shutdown.sh</span><br><span class="line"><span class="meta">#</span> 如果是正式环境可以采用nohup的方式手动启动</span><br></pre></td></tr></table></figure>
<h5 id="登录Web用户界面-进行操作"><a href="#登录Web用户界面-进行操作" class="headerlink" title="登录Web用户界面, 进行操作"></a>登录Web用户界面, 进行操作</h5><p>网址示例: <a href="https://192.168.56.3:8443/" target="_blank" rel="noopener">https://192.168.56.3:8443</a><br><img src="https://ws3.sinaimg.cn/large/68ce759fly1g1qg49bnonj20fc0azglx.jpg" alt></p>
<h4 id="Azkaban实战"><a href="#Azkaban实战" class="headerlink" title="Azkaban实战"></a>Azkaban实战</h4><blockquote>
<p>Azkaba内置的任务类型支持 command、java， 我们可以安装python、datax、sqoop等工具，进行扩展。</p>
</blockquote>
<p>简单示例， 操作步骤:</p>
<h5 id="创建-job描述文件"><a href="#创建-job描述文件" class="headerlink" title="创建 job描述文件"></a>创建 job描述文件</h5><h6 id="command类型单一job示例"><a href="#command类型单一job示例" class="headerlink" title="command类型单一job示例"></a>command类型单一job示例</h6><p><code>vim command.job</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> command.job</span><br><span class="line">type=command</span><br><span class="line">command=echo 'hello'</span><br></pre></td></tr></table></figure>
<h6 id="command类型多job工作流flow示例"><a href="#command类型多job工作流flow示例" class="headerlink" title="command类型多job工作流flow示例"></a>command类型多job工作流flow示例</h6><p><code>vim foo.job</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> foo.job</span><br><span class="line">type=command</span><br><span class="line">command=echo foo</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> bar.job</span><br><span class="line">type=command</span><br><span class="line">dependencies=foo</span><br><span class="line">command=echo bar</span><br></pre></td></tr></table></figure>
<h6 id="HDFS操作任务示例"><a href="#HDFS操作任务示例" class="headerlink" title="HDFS操作任务示例"></a>HDFS操作任务示例</h6><p><code>vim fs.job</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># fs.job</span><br><span class="line">type=command</span><br><span class="line">command=hadoop fs -mkdir /azkaban</span><br></pre></td></tr></table></figure>
<h6 id="MapReduce任务示例"><a href="#MapReduce任务示例" class="headerlink" title="MapReduce任务示例"></a>MapReduce任务示例</h6><p><code>vim mrwc.job</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> mrwc.job</span><br><span class="line">type=command</span><br><span class="line"><span class="meta">#</span> 也可以将jar包放在mrwc.job的同级目录下, 与其一起压缩为zip文件</span><br><span class="line">command=hadoop jar /home/hadoop/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.7.3.jar wordcount /input/a.txt /input/output</span><br></pre></td></tr></table></figure>
<h6 id="HIVE脚本任务示例"><a href="#HIVE脚本任务示例" class="headerlink" title="HIVE脚本任务示例"></a>HIVE脚本任务示例</h6><p><code>vim hivef.job</code> <code>vim test.sql</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> hivef.job</span><br><span class="line">type=command</span><br><span class="line">command=hive -f 'test.sql'</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> test_db;</span><br></pre></td></tr></table></figure>
<h5 id="将所有-job资源文件打包压缩成-zip文件-登录-azkaban的-web管理平台-上传-执行"><a href="#将所有-job资源文件打包压缩成-zip文件-登录-azkaban的-web管理平台-上传-执行" class="headerlink" title="将所有 job资源文件打包压缩成 zip文件, 登录 azkaban的 web管理平台, 上传, 执行"></a>将所有 job资源文件打包压缩成 zip文件, 登录 azkaban的 web管理平台, 上传, 执行</h5><h3 id="启动azkaban遇到问题解决"><a href="#启动azkaban遇到问题解决" class="headerlink" title="启动azkaban遇到问题解决"></a>启动azkaban遇到问题解决</h3><h5 id="启动exec-server异常"><a href="#启动exec-server异常" class="headerlink" title="启动exec-server异常"></a>启动exec-server异常</h5><p>异常：<code>java.io.FileNotFoundException:</code> <code>conf/global.properties</code> (没有那个文件或目录)<br>解决方法：<code>vim azkaban.properties</code> 修改 <code>executor.global.properties</code> 为绝对路径 </p>
<h5 id="启动exec-web异常"><a href="#启动exec-web异常" class="headerlink" title="启动exec-web异常"></a>启动exec-web异常</h5><p>异常：<br><code>java.lang.RuntimeException:java.lang.reflect.InvocationTargetException</code></p>
<p>解决方法：<code>vim azkaban.properties</code> 修改 <code>user.manager.xml.file</code> 为绝对路径 </p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://blog.csdn.net/qq_38474729/article/details/82655641" target="_blank" rel="noopener">https://blog.csdn.net/qq_38474729/article/details/82655641</a></li>
</ul>

      
    </div>

    

    
    
    

    
    
      <div>
        <div>
    <div style="margin: 20px 0; text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
</div>
      </div>
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/centos/" rel="tag"><i class="fa fa-tag"></i> centos</a>
          
            <a href="/tags/java/" rel="tag"><i class="fa fa-tag"></i> java</a>
          
            <a href="/tags/azkaban/" rel="tag"><i class="fa fa-tag"></i> azkaban</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/14/install-influxdb-in-centos7/" rel="next" title="InfluxDB安装部署(CentOS)">
                <i class="fa fa-chevron-left"></i> InfluxDB安装部署(CentOS)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNTU5Mi8xMjEyOA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Eason Wu">
            
              <p class="site-author-name" itemprop="name">Eason Wu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/easonwy" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:easonwu85@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#必备软件"><span class="nav-number">1.</span> <span class="nav-text">必备软件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#单机安装步骤"><span class="nav-number">2.</span> <span class="nav-text">单机安装步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多执行器模式安装"><span class="nav-number">3.</span> <span class="nav-text">多执行器模式安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#文件下载"><span class="nav-number">4.</span> <span class="nav-text">文件下载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#登陆mysql-设置编码为utf8-为Azkaban创建数据库-并授权-导入脚本"><span class="nav-number">5.</span> <span class="nav-text">登陆mysql, 设置编码为utf8, 为Azkaban创建数据库, 并授权, 导入脚本</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建SSL配置"><span class="nav-number">6.</span> <span class="nav-text">创建SSL配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#zkaban-web服务器配置及用户配置-进入web服务器安装目录conf"><span class="nav-number">7.</span> <span class="nav-text">zkaban web服务器配置及用户配置, 进入web服务器安装目录conf</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#azkaban-executor服务器配置-进入执行服务器安装目录conf"><span class="nav-number">8.</span> <span class="nav-text">azkaban executor服务器配置, 进入执行服务器安装目录conf</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动各个服务器"><span class="nav-number">9.</span> <span class="nav-text">启动各个服务器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#登录Web用户界面-进行操作"><span class="nav-number">10.</span> <span class="nav-text">登录Web用户界面, 进行操作</span></a></li></ol><li class="nav-item nav-level-4"><a class="nav-link" href="#Azkaban实战"><span class="nav-number"></span> <span class="nav-text">Azkaban实战</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建-job描述文件"><span class="nav-number">1.</span> <span class="nav-text">创建 job描述文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#command类型单一job示例"><span class="nav-number">1.1.</span> <span class="nav-text">command类型单一job示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#command类型多job工作流flow示例"><span class="nav-number">1.2.</span> <span class="nav-text">command类型多job工作流flow示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#HDFS操作任务示例"><span class="nav-number">1.3.</span> <span class="nav-text">HDFS操作任务示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#MapReduce任务示例"><span class="nav-number">1.4.</span> <span class="nav-text">MapReduce任务示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#HIVE脚本任务示例"><span class="nav-number">1.5.</span> <span class="nav-text">HIVE脚本任务示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#将所有-job资源文件打包压缩成-zip文件-登录-azkaban的-web管理平台-上传-执行"><span class="nav-number">2.</span> <span class="nav-text">将所有 job资源文件打包压缩成 zip文件, 登录 azkaban的 web管理平台, 上传, 执行</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动azkaban遇到问题解决"><span class="nav-number"></span> <span class="nav-text">启动azkaban遇到问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#启动exec-server异常"><span class="nav-number">1.</span> <span class="nav-text">启动exec-server异常</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动exec-web异常"><span class="nav-number">2.</span> <span class="nav-text">启动exec-web异常</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考资料"><span class="nav-number"></span> <span class="nav-text">参考资料</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eason Wu</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("RJcyloaaqVU2EDYLipsQXxsT-gzGzoHsz", "jvkJyc2w3aYDSOuGj6LKFAeF");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  


  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>
